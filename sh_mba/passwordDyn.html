<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>个人中心-修改密码</title>
<link href="css/common.css" rel="stylesheet" type="text/css" />
<link href="css/style.css" rel="stylesheet" type="text/css" />
<script src="js/jquery-1.7.min.js" language="javascript" type="text/javascript"></script>
</head>
<body>
<div class="hder">
  <div class="hder_top">
    <div class="hder_l">
      <a href="#" title="上海交通大学" class="fl" style="margin-right:10px; display:inline;">
        <img src="images/logo.png" width="303" height="48">
      </a>
      <span class="fl">
        学生系统
      </span>
    </div>
    <div class="hder_r">
      <p>
          欢迎 <span>李晓京</span>，今天是：<span>2014年4月12日</span> |
          <a href="#">安全退出</a>   
      </p>
    </div>
  </div>
  <div class="hder_nav">
  	<div class="nav">
 <table class="f4 nav_table" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><div class="nav_list"><a class="nav_a" href="#">首页</a></div></td>
    <td>
    <div class="nav_list"><a class="nav_a" href="#">我的课程</a>
     <ul class="nav_ul2">
      <li class="nav_li2" style="border:none;"><a href="#" class="nav_a2">培养计划</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2 nav_carent">我的课表</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2">MBA选课</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2">课程/学籍申请调整</li>
     </ul>
    </div>
    </td>
    <td>
    <div class="nav_list"><a class="nav_a" href="#">我的事务</a>
     <ul class="nav_ul2">
      <li class="nav_li2" style="border:none;"><a href="#" class="nav_a2">二级导航</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2">二级导航</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2">二级导航</a></li>
     </ul>
    </div>
    </td>
    <td>
    <div class="nav_list"><a class="nav_a" href="#">活动预告</a>
     <ul class="nav_ul2">
      <li class="nav_li2" style="border:none;"><a href="#" class="nav_a2">二级导航</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2">二级导航</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2">二级导航</a></li>
     </ul>
    </div>
    </td>
    <td>
    <div class="nav_list"><a class="nav_a" href="#">常用文档</a></div>
    </td>
    <td>
    <div class="nav_list"><a class="nav_a" href="#">个人中心</a></div>
    </td>
  </tr>
 </table>
</div>
<script src="js/public.js" language="javascript" type="text/javascript"></script>
  </div>
</div>

<!--TODO : startCopy-->

<script src='js/login.js'></script>
<script type="text/javascript" src="js/angular.min.js" ></script>
<!--[if lte IE 8]>
    <script type="text/javascript" src="js/json3.min.js" ></script>
    <script>
	    document.createElement('ng-include');
        document.createElement('ng-pluralize');
        document.createElement('ng-view');
        document.createElement('ng:include');
        document.createElement('ng:pluralize');
        document.createElement('ng:view');
	</script>
<![endif]-->

<div class="s_main">
  
  <!--left menu-->
  <div id="left_div_id">
    <script>$("#left_div_id").load("/mbastu/_menu/menu_1086.html",function(){setCurrent("密码修改");});</script>
  </div>
  
  <div class="s_main_r" id='ng-app' ng-app='PasswordApp'>
	<div class="address" ng-controller='PasswordController'>
      <div class="address_tit">
        <h2>密码修改</h2>
      </div>
      <div class="password_change">
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td align="right" height="36">旧密码</td>
            <td width="12">&nbsp;</td>
            <td width="226">
              <input class="password_tab_ipt1" type="password" ng-model="passwordObject.oldPassword">
            </td>
            <td width="6">&nbsp;</td>
            <td>
              <span class="password_change_ts">请输入旧密码</span>
            </td>
          </tr>
          <tr>
            <td align="right" height="36">新密码</td>
            <td>&nbsp;</td>
            <td>
              <input class="password_tab_ipt1" type="password" ng-model="passwordObject.newPassword">
            </td>
            <td>&nbsp;</td>
            <td>
              <span class="password_change_ts">6-16位字母,数字,符号</span>
            </td>
          </tr>
          <tr>
            <td align="right" height="36">确认新密码</td>
            <td>&nbsp;</td>
            <td>
              <input class="password_tab_ipt1" type="password" ng-model="passwordObject.confirmPassword">
            </td>
            <td>&nbsp;</td>
            <td>
              <span class="password_change_ts">请再次确认新密码</span>
            </td>
          </tr>
          <tr>
            <td align="right" height="36">验证码</td>
            <td>&nbsp;</td>
            <td>
              <div class="password_yzm_box">
                <input class="password_yzm" type="text" ng-model="passwordObject.verifyCode">
        	    <a href="#" title="" class="password_yzmtp">
              	  <img src="" title="点击换一张图片" id="_verify" width="75" height="26">
                </a> 
              </div>
            </td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td><a href title="" class="address_seach_ss_an" ng-click='updatePassword()'>保存</a></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
        </table>

      </div>
      
    </div>
  </div>
  <div class="clear"></div>
</div>
<script>
	var PasswordAppModule = angular.module('PasswordApp', []).config(function($sceProvider){$sceProvider.enabled(false);});
	
	PasswordAppModule.factory('PasswordInterface',function($http){
		var _ = {};
		_.updatePassword = function(passwordObject, callback){
			if (!isValidParameter(passwordObject)){
				alert("请确保新密码与确认新密码一致并填写旧密码和验证码！");
				return;
			}
			$.ajax({
				type:"post",
				url:psc_url + "WEBLIB_MBA_STU.TZ_MBA_STU_CONLIST.FieldFormula.IScript_FixPass",
				async:true,
				dataType:"json",
				data:passwordObject,
				success:function(data,textStatus){
					if (data.result != "success"){
						alert("修改密码失败！" + data.message);
						window.location.reload();
					}
					alert('修改密码成功');
					window.location.reload();
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
                    alert('修改密码失败！（错误码：' + XMLHttpRequest.status + "）");
                    window.location.reload();
				}
			});
		};
		function isValidParameter(passwordObject){
			if (!passwordObject.newPassword || !passwordObject.oldPassword) return false;
			if (passwordObject.confirmPassword != passwordObject.newPassword) return false;
			if (!passwordObject.verifyCode || passwordObject.verifyCode.length == 0) return false;
			return true;
		};
		return _;
	});
	
	PasswordAppModule.controller(
		'PasswordController',
		function($scope, PasswordInterface){
			var emptyPasswordObject = {
				oldPassword : '',
				newPassword : '',
				confirmPassword : '',
				verifyCode : ''
			};
			
			$scope.passwordObject = $.extend(true, {}, emptyPasswordObject);;
			
			$scope.updatePassword = function(){
				var po = $.extend(true, {}, $scope.passwordObject);
				PasswordInterface.updatePassword(po,function(){
					$scope.passwordObject = $.extend(true, {}, emptyPasswordObject);
				});
			};
		}
	);
</script>
<script>
	getVerify();
	$("#_verify").click(function(){getVerify();});
</script>

<!--TODO : endCopy-->

<div class="footer">
	<div class="ft_box">
      <div class="ft_box_l">
        <h2>帮助中心:</h2>
        <p class="bzzx"><a href="#" title="" class="bzzx1">可以注册多个账号么？</a>/ <a href="#" title="">填写信息需要使用中文还是英文？ </a>/ <a href="#" title="">密码忘记后如何找回？ </a>/ <a href="#" title="">系统显示乱码或出错怎么办？</a></p>
        <div class="ft_list">
          <ul>
            <li style="margin-left:-8px;"><a href="#" title="">关羽安泰</a></li>
            <li><a href="#" title="">网站地图</a></li>
            <li><a href="#" title="">友情链接</a></li>
            <li><a href="#" title="">帮助中心</a></li>
            <li style="background:none;"><a href="#" title="">联系我们</a></li>
          </ul>
          <a href="#" title="" class="ft_box_r">
            <img src="images/login_5.jpg" width="238" height="50">
          </a>
        </div>
        <p class="bqsy">Copyright 2011-2014 © 上海交通大学安泰经济与管理学院</p>
      </div>
      <div class="clear"></div>
    </div>
</div>
</body>
</html>