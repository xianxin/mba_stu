<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>我的课表-培训计划</title>
<link href="css/common.css" rel="stylesheet" type="text/css" />
<link href="css/style.css" rel="stylesheet" type="text/css" />
<script src='js/jquery-1.7.min.js'></script>
</head>
<body>
<div class="hder">
  <div class="hder_top">
    <div class="hder_l">
      <a href="#" title="上海交通大学" class="fl" style="margin-right:10px; display:inline;">
        <img src="images/logo.png" width="303" height="48">
      </a>
      <span class="fl">
        学生系统
      </span>
    </div>
    <div class="hder_r">
      <p>
          欢迎 <span>李晓京</span>，今天是：<span>2014年4月12日</span> |
          <a href="#">安全退出</a>   
      </p>
    </div>
  </div>
  <div class="hder_nav">
  	<div class="nav">
 <table class="f4 nav_table" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><div class="nav_list"><a class="nav_a" href="#">首页</a></div></td>
    <td>
    <div class="nav_list"><a class="nav_a" href="#">我的课程</a>
     <ul class="nav_ul2">
      <li class="nav_li2" style="border:none;"><a href="#" class="nav_a2">培养计划</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2 nav_carent">我的课表</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2">MBA选课</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2">课程/学籍申请调整</li>
     </ul>
    </div>
    </td>
    <td>
    <div class="nav_list"><a class="nav_a" href="#">我的事务</a>
     <ul class="nav_ul2">
      <li class="nav_li2" style="border:none;"><a href="#" class="nav_a2">二级导航</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2">二级导航</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2">二级导航</a></li>
     </ul>
    </div>
    </td>
    <td>
    <div class="nav_list"><a class="nav_a" href="#">活动预告</a>
     <ul class="nav_ul2">
      <li class="nav_li2" style="border:none;"><a href="#" class="nav_a2">二级导航</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2">二级导航</a></li>
      <li class="nav_li2"><a href="#" class="nav_a2">二级导航</a></li>
     </ul>
    </div>
    </td>
    <td>
    <div class="nav_list"><a class="nav_a" href="#">常用文档</a></div>
    </td>
    <td>
    <div class="nav_list"><a class="nav_a" href="#">个人中心</a></div>
    </td>
  </tr>
 </table>
</div>
  </div>
</div>

<!--TODO : startCopy-->

<script type="text/javascript" src="js/angular.min.js"></script>
<div class="s_main">
  
	<!--left menu-->
  <div id="left_div_id">
    <script>$("#left_div_id").load("/mbastu/_menu/menu_503.html");</script>
  </div>
  
  <div class="s_main_r" id="ng-app" ng-app="TeachingProgramApp">
    <div class="schedule_cont" ng-controller="TeachingProgramController">
      <div class="schedule_cont_bt">
        <h2 ng-bind='program.display_studentName'></h2>
        <div class="schedule_cont_xh">
        	<span class="schedule_cont_xh_one">学号：<em ng-bind='program.studentId'></em></span>
            <span class="schedule_cont_xh_two">班级：<em ng-bind='program.className'></em></span>
            <span class="schedule_cont_xh_three">预计毕业日期：<em ng-bind='program.graDate'></em></span>
            <div class="clear"></div>
        </div>
        <div class="pyjh_bxk">
          <h2 ng-bind='program.display_compulsoryCreditStatus'></h2>
          <table width="736" border="0" cellpadding="0" cellspacing="0">
            <tr>
              <td height="58" rowspan="2" width="132">课程名称</td>
              <td rowspan="2" width="86">课程性质</td>
              <td rowspan="2" width="56">学时</td>
              <td rowspan="2" width="46">学分</td>
              <td colspan="4" height="32" width="164">第一学期</td>
              <td rowspan="2" width="41">实际<br>
                上课<br>
              学期</td>
              <td rowspan="2" width="51">等级分</td>
              <td rowspan="2" width="66">课程备注</td>
              <td rowspan="2" width="79">课程异动<br>
              备注</td>
            </tr>
            <tr>
              <td height="26" width="41">1</td>
              <td width="41">2</td>
              <td width="41">3</td>
              <td width="41">4</td>
            </tr>
            
            <tr bgcolor="#F2F3F3" ng-repeat='courseCompulsory in program.compulsory'>
            	<td height="50" background="none">{{courseCompulsory.courseName}}</td>
            	<td>{{courseCompulsory.courseNature}}</td>
            	<td>{{courseCompulsory.courseHours}}</td>
            	<td>{{courseCompulsory.credit}}</td>
            	
            	<td>
            		<span ng-if='courseCompulsory.YJTerm == 1' class="pyjh_bxk_dg"><img src="images/pyjh_1.jpg" width="22" height="22"></span>
            		<span ng-if='courseCompulsory.YJTerm != 1'>&nbsp;</span>
            	</td>
            	<td>
            		<span ng-if='courseCompulsory.YJTerm == 2' class="pyjh_bxk_dg"><img src="images/pyjh_1.jpg" width="22" height="22"></span>
            		<span ng-if='courseCompulsory.YJTerm != 2'>&nbsp;</span>
            	</td>
            	<td>
            		<span ng-if='courseCompulsory.YJTerm == 3' class="pyjh_bxk_dg"><img src="images/pyjh_1.jpg" width="22" height="22"></span>
            		<span ng-if='courseCompulsory.YJTerm != 3'>&nbsp;</span>
            	</td>
            	<td>
            		<span ng-if='courseCompulsory.YJTerm == 4' class="pyjh_bxk_dg"><img src="images/pyjh_1.jpg" width="22" height="22"></span>
            		<span ng-if='courseCompulsory.YJTerm != 4'>&nbsp;</span>
            	</td>
            	
            	<td>{{courseCompulsory.SJTerm}}</td>
            	<td>{{courseCompulsory.courseRank}}</td>
            	<td ng-bind-html='courseCompulsory.courseRank | checkTdEmpty'></td>
            	<td ng-bind-html='courseCompulsory.changeRemark | checkTdEmpty'></td>
            </tr>
          </table>
        </div>
        <div class="pyjh_bxk">
          <h2 ng-bind='program.display_electivesCreditStatus'></h2>
          <table width="736" border="0" cellpadding="0" cellspacing="0">
            <tr>
              <td height="58" width="132">课程名称</td>
              <td width="86">课程性质</td>
              <td width="56">学时</td>
              <td width="56">学分</td>
              <td width="122">实际上课学期</td>
              <td width="80">等级分</td>
              <td width="76">课程备注</td>
              <td width="112">课程异动备注</td>
            </tr>
            
            
            <tr bgcolor="#F2F3F3" ng-repeat='courseElectives in program.electives'>
            	<td height="50" background="none">{{courseElectives.courseName}}</td>
            	<td>{{courseElectives.courseNature}}</td>
            	<td>{{courseElectives.courseHours}}</td>
            	<td>{{courseElectives.credit}}</td>
            	<td>{{courseElectives.SJTerm}}</td>
            	<td>{{courseElectives.courseRank}}</td>
            	<td ng-bind-html='courseElectives.courseRank | checkTdEmpty'></td>
            	<td ng-bind-html='courseElectives.changeRemark | checkTdEmpty'></td>
            </tr>
            
          </table>
        </div>
        <div class="pyjh_box">
          <h2>培养计划备注信息</h2>
          <p>{{program.programRemark}}</p>
        </div>
      </div>
    </div>
  </div>
  <div class="clear"></div>
</div>
<script>
	var fakeProgram = {
		studentId : '5090379149',
		className : 'F0903705',
		graDate : '2013-09-09',
		compulsory : [
		{courseName : "SE", courseNature : 'Com', courseHours : '24', credit : '2', YJTerm : 1, SJTerm : 2, courseRank : 2, courseRemark : '', changeRemark : ''},
		{courseName : "SE", courseNature : 'Com', courseHours : '24', credit : '2', YJTerm : 2, SJTerm : 2, courseRank : 2, courseRemark : '', changeRemark : ''},
		{courseName : "SE", courseNature : 'Com', courseHours : '24', credit : '2', YJTerm : 3, SJTerm : 2, courseRank : 2, courseRemark : '', changeRemark : ''},
		{courseName : "SE", courseNature : 'Com', courseHours : '24', credit : '2', YJTerm : 3, SJTerm : 2, courseRank : 2, courseRemark : '', changeRemark : ''},
		{courseName : "SE", courseNature : 'Com', courseHours : '24', credit : '2', YJTerm : 1, SJTerm : 2, courseRank : 2, courseRemark : '', changeRemark : ''}
		],
		electives : [
		{courseName : "SE", courseNature : 'Com', courseHours : '24', credit : '1', SJTerm : 2, courseRank : 2, courseRemark : '', changeRemark : ''},
		{courseName : "SE", courseNature : 'Com', courseHours : '24', credit : '2', SJTerm : 2, courseRank : 2, courseRemark : '', changeRemark : ''},
		{courseName : "SE", courseNature : 'Com', courseHours : '24', credit : '3', SJTerm : 2, courseRank : 2, courseRemark : '', changeRemark : ''},
		{courseName : "SE", courseNature : 'Com', courseHours : '24', credit : '4', SJTerm : 2, courseRank : 2, courseRemark : '', changeRemark : ''}
		],
		compulsoryGot : 10,
		compulsoryAll : 19,
		electivesGot : 9,
		electivesAll : 14,
		programRemark : '1'
	};
	/*old version:compulsoryGot : 10,compulsoryAll : 19, electivesGot : 9,electivesAll : 14,programRemark : '1'*/

	var studentName;
	
	var test_local = true;
	var ProgramAppModule = angular.module('TeachingProgramApp', []).filter('checkTdEmpty', function(){
		return function(input){
			if (angular.isString(input) && !(angular.equals(input, null) || angular.equals(input,''))){
				return input;
			} else {
				return '&nbsp;';
			}
		};
	}).filter('to_trusted',['$sce',function($sce){
		return function(text){return $sce.trustAsHtml(text);};
	}]).config(function($sceProvider){$sceProvider.enabled(false);});
	
	ProgramAppModule.factory('ProgramInterface',function($http){
		var _ = {};
		_.getProgramData = function(callback){
			/* if (test_local) {callback(fakeProgram); return ;} */
			$http.post('/psc/ACEMTST/EMPLOYEE/CRM/s/WEBLIB_MBA_STU.TZ_MBA_STU_COURSE.FieldFormula.Iscript_TrainPlan',{params:{}
			}).success(function(data,status,headers,config){
				callback(data);
				return;
			}).error(function(data,status,headers,config){
				alert('无法获取培养计划！（错误码：' + status + "）" );
				callback(null);
				return;
			});
		};
		return _;
	});
	
	ProgramAppModule.controller(
		'TeachingProgramController',
		function($scope, ProgramInterface){
			var defaultProgram = {
				studentId : '',
				className : '',
				graDate : '',
				compulsory : [],
				electives : [],
				compulsoryGot : '',
				compulsoryAll : '',
				electivesGot : '',
				electivesAll : '',
				programRemark : ''
			};
			
			function decoration(obj){
				obj.display_studentName = (studentName || "") + " 培养计划";
				obj.display_compulsoryCreditStatus = "必修课列表，要求必修课总学分" + obj.compulsoryAll + "，已修必修课总学分" + obj.compulsoryGot;
				obj.display_electivesCreditStatus = "选修课列表，要求选修课总学分" + obj.electivesAll + "，已修选修课总学分" + obj.electivesGot;
				
				return obj;
			}
			var program = $.extend(true, {}, defaultProgram);
			$scope.program = decoration(program);
			
			ProgramInterface.getProgramData(function(data){
				if (data){
					$scope.program = decoration(data);
				}
			});
			
			getStudentObject(function(studentObject){
				if (studentObject && studentObject.name){
					studentName = studentObject.name;
					$scope.program.displayDPI = (studentName || "") + " 培养计划";
				}
			});
		}
	);
</script>

<!--TODO : endCopy-->
<div class="footer">
	<div class="ft_box">
      <div class="ft_box_l">
        <h2>帮助中心:</h2>
        <p class="bzzx"><a href="#" title="" class="bzzx1">可以注册多个账号么？</a>/ <a href="#" title="">填写信息需要使用中文还是英文？ </a>/ <a href="#" title="">密码忘记后如何找回？ </a>/ <a href="#" title="">系统显示乱码或出错怎么办？</a></p>
        <div class="ft_list">
          <ul>
            <li style="margin-left:-8px;"><a href="#" title="">关羽安泰</a></li>
            <li><a href="#" title="">网站地图</a></li>
            <li><a href="#" title="">友情链接</a></li>
            <li><a href="#" title="">帮助中心</a></li>
            <li style="background:none;"><a href="#" title="">联系我们</a></li>
          </ul>
          <a href="#" title="" class="ft_box_r">
            <img src="images/login_5.jpg" width="238" height="50">
          </a>
        </div>
        <p class="bqsy">Copyright 2011-2014 © 上海交通大学安泰经济与管理学院</p>
      </div>
      <div class="clear"></div>
    </div>
</div>

</body>
</html>
